# **简易加密器 操作手册**

### 1.**功能**

预计实现的功能如下:

| **STC-B实现功能** | ($^*$项表示对此有说明)                   |
| ----------------- | ---------------------------------------- |
| 功能0 :           | 密码锁                                   |
| 功能1：           | 采集加密因子$^*$并加密数据(一重加密$^*$) |
| 功能2：           | 更改密码锁的密码                         |
| 功能3：           | 发送加密因子给其他STC-B设备              |
| 功能4：           | 解密(对一重加密进行解密为初始形态$^*$)   |
| 功能5:            | 查看加密因子以及上一次加密的数据         |
| 功能6:            | 不更新加密因子直接加密数据(一重加密)     |
| 功能7:            | 未解锁时作为音乐播放器                   |

| **上位机实现功能** | ($^*$项表示对此有说明)                       |
| ------------------ | -------------------------------------------- |
| 功能1:             | 对数据进行二重加密$^*$(加密为藏头诗)         |
| 功能2：            | 对二重加密后的数据进行解密(回到一重加密状态) |
| 功能3:             | 打开串口与关闭串口                           |
| 功能4：            | 发送数据给串口 以及 接收数据                 |

**说明:** 

##### 1.对于一个数字，定义了以下几种状态:

​          **初始形态**$^*$     < --- >    **一重加密$^*$**    < --- >   **二重加密$^*$**

​       其中，初始形态为待加密的数字(设置为3位)，一重加密为在STC-B板上进行简单的初步加密(变为6位数)，二重加密在一重加密的基础上，通过上位机进行处理，最终得到二重加密(一首藏头诗)。

​      解密的流程与上述过程相反: 二重加密通过上位机解密为一重加密，一重加密再由STC-B解密为初始形态。

#####   2.加密因子$^*$

​         **用于辅助初始状态的数字加密成为一重加密的数据。**本项目中共有两个加密因子： 1.由ADC模块得到当前的光照值  2.输入一个三位数。加密因子1用于保证随机性，加密因子2用于保证可控性。两个加密因子辅助初始状态转化为一重加密。

### 2.**操作指南**

| **STC-B**        | 触发条件与操作指南                                           |
| ---------------- | ------------------------------------------------------------ |
| 0:密码锁         | 数码管第一位显示0。开机自动进入,输入密码后按下导航的center键确认 |
| 1:采集因子并加密 | 数码管第一位显示1。在4s内按下K1键3次。采集光照完成后按下K1 -> 输入数值后按下K1 ->串口发送以AA开头的8位数据按K1 -> 显示加密结果并发送给上位机 -> 按下K1将加密因子存储,数码管第一位显示8,提示存储成功 |
| 2:改密码         | 数码管第一位显示2。在4s内按下K1键4次。调整结束后按下导航的center键确认 |
| 功能3:发加密因子 | 数码管第一位显示3。在4s内按下K1键5次。此时出现流水灯景象，按下K1将内部的加密因子发送通过红外发送给其他STC-B板。接收后对方的STC-B板的加密因子将会改变。 |
| 4:解密           | 按下K3键。出现流水灯以及8位数字滚动显示。在串口上发送待解密的8位数(AA开头，后六位为有效的一重加密),STC-B显示解密结果 |
| 5:看加密因子     | 数码管第一位显示5。按下K2。在其他功能没有完成的时候按下K2会进行复位，清除进度。然后多次按下K2 STC-B将显示两个加密因子以及上一次加密的初始状态 |
| 6:直接加密       | 数码管第一位显示6。与5相关联。在按下K2使得显示出第二个加密因子的时,通过串口发送待加密数据，按下K1显示加密结果 |
| 7:音乐播放       | 未解锁时作为音乐播放器。通过振动来控制播放与暂停，也可通过按下K2来紧急暂停。播放曲目为*$memory$*。接触密码锁后无效。 |



| **上位机**  | 触发条件与操作指南                                           |
| ----------- | ------------------------------------------------------------ |
| 1:二重加密  | 上框中输入6位数字(一重加密)，按下加密键下框将显示藏头诗结果  |
| 2:解密      | 在上框输入藏头诗，按下解密键显示解密的数字(一重加密)         |
| 3:开/关串口 | 按下打开串口或关闭串口键。弹窗提示相应信息。                 |
| 4:收发串口  | 上框中输入待发送数据，按下发送键发送。按下显示串口接收后尝试去复制下框内容，可刷新得到串口接收到的数据 |



#### **补充1 数据发送规范**

数码管上的每一位对应串口输入的一个16进制值(如数码管上的0对应0x00)。

1)**进行一重加密**应发送数据格式为 8位16进制，以AA开头，最后3位为待加密数字。如 AA 00 00 00 00 04 05 06表示发送 456 给单片机作为待加密数字，加密完成后返回加密结果给单片机(如单片机上显示加密结果为 051142，在上位机程序的结果框内尝试选中内部的内容刷新，则会显示00 05 01 01 04 02)。

2)**进行一重加密的解密**发送8位16进制，以AA开头，如AA 00 00 05 01 01 04 02。

3)在**藏头诗生成器上加密**:输入6位16进制。如 00 00 00 00 00 00。

4)在**藏头诗生成器上解密**:将藏头诗直接赋值到输入框，点击解密。



#### **补充2 一个可能的程序体验流程**

1) 初始密码为123,方向键控制加减与改变操作的位，输入后按下导航中心键确认,小数点消失
2) 4s内按下K1 3次,数码管第一位显示为1，进入加密模式。第一个数据采集ADC值显示后,再按下K1后调整加密因子2, **按下导航键确认**。再按下K1键，从串口发送数据AA 00 00 00 00 04 05 06，显示为456，再按下K1显示一重加密结果。再按下K1将加密结果保存到单片机中。
3) 按下K2键，切换显示两个加密因子以及上次加密的内容
4) 按下K3键，将刚才的加密结果从上位机程序复制，开头加上AA 00，发送数据，即可得到解密结果
5) 将输入框内的数据删除AA 00，得到刚才一重加密的加密结果，按下上位机的加密键，藏头诗结果显示在结果框内(需要联网)
6) 将刚才的藏头诗结果复制到输入框内，点击解密，解密出一重加密的加密结果

 辅助功能流程:

​            0. 未解锁时用振动传感器控制音乐播放与暂停，按下K2可以停止播放

1. 按下K2键，再在4s内按下K1键4次，数码管第一位显示2，数码管后三位点亮且有小数点，方向键调整数据后按下导航中心键修改密码锁密码
2. 按下K2键，再在4s内按下K1键5次，数码管第一位显示3，按下K1键就能将本STC-B板内的加密因子发送给其他板,在其他板上使用K2查看内部的加密因子已经改变

   

